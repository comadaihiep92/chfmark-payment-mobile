function _typeof(a){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},_typeof(a)}function _classCallCheck(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function _defineProperties(a,b){for(var c,d=0;d<b.length;d++)c=b[d],c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(a,c.key,c)}function _createClass(a,b,c){return b&&_defineProperties(a.prototype,b),c&&_defineProperties(a,c),a}var HandleLoyaltyPlans=function(){function a(){_classCallCheck(this,a),currentPlan="",APIData={},old_plan=0,auto_renew_status=fn.getAutoRenewalFlag(),isSubscribed=!1}return _createClass(a,[{key:"getPlanMonths",value:function(a,b){var c="";return b?(c="Extend my plan",c):(this.APIData&&Object.keys(this.APIData).length&&Array.isArray(this.APIData.sub_programs)&&0<this.APIData.sub_programs.length&&(c=this.APIData.sub_programs.filter(function(b){return b.id===a})[0].buy_plan_text),c)}},{key:"getLoyaltyPlans",value:function(a){var b=this;fn.ajaxForm({},"GET","/loyalty/get-loyalty-plans").done(function(c){var d=JSON.parse(c);b.APIData=d.data,fn.populateLoyaltyLandingData(d.data),!1===a?(b.currentPlan=b.getRecommendedPlan(!1),b.renderPlanDetails(d.data,!1),$(".introduction-text").html(d.data.welcome_text)):(b.currentPlan=b.getRecommendedPlan(!0),b.renderPlanDetails(d.data,!0),$(".buy_plan button").html("".concat(b.getPlanMonths(b.getCheckedPlan())))),meatopia_data.setData({recommended_plan:b.getPlanDetailText(b.currentPlan)}),Array.isArray(d.data.sub_programs)&&d.data.sub_programs.length?meatopia_data.setData({total_plans:d.data.sub_programs.length.toString()}):meatopia_data.setData({total_plans:"0"}),localStorage.setItem("loyalty_recommended",b.getRecommendedPlan(!1).toString()),localStorage.setItem("loyalty_total_plans",d.data.sub_programs.length.toString())}).fail(function(){}).always(function(){})}},{key:"getExpiryDate",value:function(a){document.querySelector(".validity-text").innerHTML="Your plan is valid till ".concat(this.getDate(a))}},{key:"getLoyaltyBenefits",value:function(a){var b=document.querySelector(".benefits-list");return a.data.subscribed.benefits.map(function(a){b.innerHTML+="\n            <div class=\"single-benefit\">\n                    <img src=".concat(a.image_url," />\n                <div class=\"right-view\">\n                        <div class=\"title\">").concat(a.name," </div>\n                    <div class=\"description\">").concat(a.description,"</div>\n                </div>\n            </div>\n          ")})}},{key:"getRecommendedPlan",value:function(a){var b=this;if(!1===a){var c=[],d="";return c=this.APIData.sub_programs.filter(function(a){return!0===a.is_recommended}),Array.isArray(c)&&c.length?d=this.APIData.sub_programs.filter(function(a){return!0===a.is_recommended})[0].id:Array.isArray(this.APIData.sub_programs)&&0<this.APIData.sub_programs.length&&(d=this.APIData.sub_programs[0].id),d}var e=function(){for(var a=document.querySelectorAll(".loyalty_plan"),c="",d=function(d){!0===a[d].checked&&(c=b.APIData.sub_programs.filter(function(b){return b.id===parseInt(a[d].value)})[0].id)},e=0;e<a.length;e++)d(e);if(""===c){var f=[],g="";return f=b.APIData.sub_programs.filter(function(a){return!0===a.is_recommended}),Array.isArray(f)&&f.length?g=b.APIData.sub_programs.filter(function(a){return!0===a.is_recommended})[0].id:Array.isArray(b.APIData.sub_programs)&&0<b.APIData.sub_programs.length&&(g=b.APIData.sub_programs[0].id),{v:g}}return{v:c}}();if("object"===_typeof(e))return e.v}},{key:"renderPlanDetails",value:function(a){var b=!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1];if(!b){var c=document.querySelector(".ll-container .plan-section");c.innerHTML="\n            ".concat(this.renderAllPlans(a.sub_programs,!1),"\n            ")}else{var d=document.querySelector(".plan_pop_up .plan-section");d.innerHTML="\n            ".concat(this.renderAllPlans(a.sub_programs,!0),"\n            ")}}},{key:"checkNoPlanSelection",value:function(){for(var a=!1,b=document.querySelectorAll(".loyalty_plan"),c=0;c<b.length;c++)if(!0===b[c].checked){a=!0;break}a||(b[0].checked=!0,b[0].parentNode.parentNode.parentNode.style.border="solid 1px #e41d36")}},{key:"renderBenefit",value:function(a){var b="";return 0==a.length%2&&0!=a.length%3?a.map(function(a){var c=a.name.split(" ").splice(0,2).join(" ");b+="\n                <div class=\"benefitViewShow\">\n                    <div class=\"benefitImage\"><img src=\"".concat(a.imageUrl,"\"></div>\n                    <div class=\"benefitText\">\n                    ").concat(c,"\n                    </div>\n                </div>\n            ")}):a.map(function(a){var c=a.name.split(" ").splice(0,2).join(" ");b+="\n                    <div class=\"benefitView\">\n                        <div class=\"benefitImage\"><img src=".concat(a.imageUrl,"></div>\n                        <div class=\"benefitText\">\n                        ").concat(c,"\n                        </div>\n                    </div>\n                ")}),b}},{key:"renderAllPlans",value:function(a,b){var c=this,d="";return a.map(function(a,e){d+="<label class=\"contain\"><div class=\"single-plan\" ".concat(b?c.currentPlan===a.id?"style=\"border:solid 1px #e41d36\"":"style=\"border:none\"":a.is_recommended?"style=\"border:none\"":"style=\"border:none\"",">\n        <div class=\"left\">\n          <label class=\"contain\">\n            <span class=\"plan_text\">").concat(a.name,"</span>\n            <input type=\"radio\" value=").concat(a.id," id=\"plan_").concat(e+1,"\"class=\"loyalty_plan\" ").concat(b?a.id===c.currentPlan?"checked":"":a.is_recommended?"":"",">\n            <span class=\"checkmark\"></span>\n          </label>\n          ").concat(a.is_recommended?"<div class=\"recommended\"> <div> LIMITED PERIOD</div></div>":"","\n        </div>\n        <div class=\"right\">\n          <div class=\"act_price\"> ").concat(0>=a.price-a.discounted_price?"":"&#8377 ".concat(a.price)," </div>\n          <div class=\"discount_price\">\u20B9 ").concat(a.discounted_price,"</div>\n        </div>\n      </div> </label>\n")}),d}},{key:"filterBenefit",value:function(a){var b=this.APIData.sub_programs.filter(function(b){return b.id===a})[0].benefits;return b}},{key:"handlePlanChange",value:function(a){for(var b=!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1],c=document.querySelectorAll(".loyalty_plan"),d=0;d<c.length;d++)a.target.id===c[d].id?(c[d].checked=!0,c[d].parentNode.parentNode.parentNode.style.border="solid 1px #e41d36",this.currentPlan=a.target.value):(c[d].checked=!1,c[d].parentNode.parentNode.parentNode.style.border="none");navigator.userAgent.includes("phonepe-webview")||($(".footer").show(),$(".footer div").html("".concat(this.getPlanMonths(this.getCheckedPlan(),this.isSubscribed)))),this.currentPlan=parseInt(a.target.value),b?$(".buy_plan button").html("".concat(this.getPlanMonths(this.getCheckedPlan(),this.isSubscribed))):(fn.msite.sendAnalyticsData("selectplan_loyaltyhome",{source:"loyalty",selected_plan:"".concat(this.getPlanDetailText(this.getCheckedPlan())),member_status:"non-member",auto_renewal:fn.getAutoRenewalType(),enrolment_type:meatopia_data.getDataByKeyName("enrolment_type")}),!navigator.userAgent.includes("phonepe-webview")&&$(".footer div").html("".concat(this.getPlanMonths(this.getCheckedPlan(),this.isSubscribed)))),meatopia_data.setData({selected_plan:this.getPlanDetailText(this.getCheckedPlan())})}},{key:"closePopUp",value:function(a){a.stopImmediatePropagation(),$(".plan_pop_up").hide(),$(".plan_pop_up").removeClass("show")}},{key:"buyPlan",value:function(a,b,c){var d="on"===$("#auto-renew-switch").attr("type");fn.checkAndUpdateAutoRenewal(d),window.location.href.includes("payments")?this.handlePlanSelectPayPage(a):window.location.href.includes("cart")?(fn.msite.showloader(),fn.ajaxForm({program_id:1,subprogram_id:this.getCheckedPlan()},"POST","/loyalty/add-loyalty").done(function(a){var c=JSON.parse(a);"200"===c.statusCode.toString()&&("true"===b?window.location.reload():li_fn.checkout.getCartData().then(function(a){99<a.data.cart_total&&null!==a.data.loyalty_item&&0===Object.keys(a.data.loyalty_item).length&&obj.constructor===Object&&0<document.querySelector(".cart-wrapper .delivery-free").length&&(document.querySelector(".cart-wrapper .delivery-free").innerHTML="".concat(a.data.loyalty_item[0].delivery_message)),0<document.getElementsByClassName("cart_loyalty_banner").length&&(document.getElementsByClassName("cart_loyalty_banner")[0].style.display="none")})["finally"](function(){fn.msite.hideloader()})["catch"](function(a){return console.log(a)}))}).fail(function(){}).always(function(){})):("true"===c||"true"===b)&&this.navigateToPayPage(!0,!1)}},{key:"removeLoyalty",value:function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"slot";return new Promise(function(b,c){fn.msite.showloader(),fn.ajaxForm({program_id:1,subprogram_id:"cart-page"===a?$(".banner-cross-container").attr("plan_id"):$(".home-page-loyalty-member-banner").attr("plan_id")},"POST","/loyalty/remove-loyalty").done(function(c){var d=JSON.parse(c);"cart-page"===a?li_fn.checkout.getCartData().then(function(a){0<$(".buy_plan button").length&&$(".buy_plan button").attr("modify_plan","false"),b(a)})["finally"](function(){fn.msite.hideloader()}):"reorder"===a?b(d):li_fn.checkout.getShipmentSummary().then(function(a){b(a)})}).fail(function(){c("fail")}).always(function(){})})}},{key:"getLoyaltySubsrcibedPage",value:function(a,b){var c=this,d=a.days_left,e=a.total_days,f=a.start_date,g=a.end_date,h=a.total_saving,i=a.order_count,j=a.plan_info_msg,k=a.expiry_message,l=a.is_renewable,m=a.plan_extend_message,n=a.is_expired,o=a.status,p=b.is_user_subscribed,q=b.meatopia_page_message,r="";"CONFIRMED"===o?($(".footer").show(),this.isSubscribed=!0,$(".footer div").html(this.getPlanMonths(void 0,!0)),p?(r="<div class=\"auto-renew-section\" id=\"auto-section-main\" type=\"cancel_msg\">\n                                        <img class=\"auto-renew-switch\" src=\"/images/toggle_on.svg\" />\n                                        <div class=\"auto-renew-text\">\n                                            <div class=\"auto-renew-title\">Auto-renew plan</div>\n                                            <div class=\"auto-renew-desc\">".concat(q,"</div>\n                                        </div>\n                                    </div>"),$(".footer").hide()):r="<div class=\"auto-renew-section\" id=\"auto-section-main\" type=\"update_pay\">\n                                        <img class=\"auto-renew-switch\" src=\"/images/toggle_switch_unchecked.svg\" />\n                                        <div class=\"auto-renew-text\">\n                                            <div class=\"auto-renew-title\">Auto-renew plan</div>\n                                            <div class=\"auto-renew-desc\">".concat(q,"</div>\n                                        </div>\n                                    </div>")):$(".footer").hide();var s=document.querySelector(".details-view");s.innerHTML="\n            <div class=\"top-content\">\n                <div class=\"days-left\">".concat(0===d?k:j,"</div>\n            </div>\n                <div class=\"validity\">").concat(this.getDate(f)," to ").concat(this.getDate(g),"</div>\n                ");var t=parseInt(100*(parseInt(d)/parseInt(e))),u="<div class=\"progress-bar\">\n                                            <div class=\"validity-indicator".concat(5>=d?" red":"","\" style=\"width:").concat(t,"%\"></div>\n                                          </div>");if($(".top-content").after(u),$(".validity").after(r),l){var v="<div class=\"extend-now-text loyalty-ll-m-banner\">\n                                                ".concat(n?"<div class=\"title\">RENEW</div>\n                                                    <img src=\"/images/chevron.svg\" class=\"arrow\" />":p?"":"<div class=\"title\">EXTEND NOW!</div>","\n                                            </div>");$(".top-content").append(v),$(".extend-now-text").on("click",function(a){return!$(this).hasClass("faded")&&void(a.stopPropagation(),$(".plan_pop_up").show(),$(".plan_pop_up").addClass("show"),meatopia_new_events.extend_planpage({}))})}!m||($(".extra_days_msg").show(),$(".extra_days_msg").html(m)),$("#auto-section-main").on("click",function(){if("update_pay"===$(this).attr("type"))meatopia_new_events.enable_autorenew_auth({renewal_type:"new"}),window.location.href="/customer/subscription?planId=".concat(c.getCheckedPlan());else if("cancel_msg"===$(this).attr("type")){var a=$(".cancel_pop_up_order .reasons"),b=a.find("input[type='radio'][name='radio-group']:checked");b&&b.length?($(".do_cancel_btn").addClass("do_cancel_btn_enabled"),$("#do_cancel").addClass("cancel_btn_text_enabled")):($(".do_cancel_btn").removeClass("do_cancel_btn_enabled"),$("#do_cancel").removeClass("cancel_btn_text_enabled")),$(".cancel_pop_up_container").show(),$(".cancel_pop_up_container").addClass("show"),meatopia_new_events.cancel_autorenew({}),fn.noScroll()}}),document.querySelector(".savings").innerHTML=" <span> \u20B9".concat(h,"</span> <br /> <span class='bottom_line'>total savings</span>"),document.querySelector(".order-and-savings  .orders-count").innerHTML=" <span> ".concat(i," <br /><span class='bottom_line'>orders placed</span>"),this.populateSubCancelPopUp(b)}},{key:"renderSubBenefitList",value:function(a){var b=document.querySelector(".benefits-section .benefits-list");a.map(function(a){b.innerHTML+="\n            <div class=\"single-benefit\">\n                <img src=\"".concat(a.image_url,"\" />\n                <div class=\"right-wrapper\">\n                <div class=\"right-view\">\n                    <div class=\"title\">").concat(a.name,"</div>\n                    <div class=\"description\">").concat(a.description,"</div>\n                </div>\n                </div>\n            </div>\n            ")})}},{key:"getDate",value:function(a){{var b=new Date(a);if(isNaN(b.getTime()))return a;var c=[];c[0]="Jan",c[1]="Feb",c[2]="Mar",c[3]="Apr",c[4]="May",c[5]="Jun",c[6]="Jul",c[7]="Aug",c[8]="Sept",c[9]="Oct",c[10]="Nov",c[11]="Dec";var d=b.getDate();return 10>d&&(d="0"+d),d+"-"+c[b.getMonth()]+"-"+b.getFullYear()}}},{key:"navigateToPayPage",value:function(a){var b=this,c=!!(1<arguments.length&&void 0!==arguments[1])&&arguments[1],d=this;a?(fn.msite.showloader(),fn.msite.clearCartApi().then(function(){fn.ajaxForm({program_id:1,subprogram_id:b.getCheckedPlan(),direct_purchase:!0},"POST","/loyalty/add-loyalty").done(function(){c?($(".plan_pop_up").show(),$(".plan_pop_up").addClass("show")):setTimeout(function(){window.location.href="/customer/payments?planId=".concat(d.getCheckedPlan())},400)}).fail(function(){li_fn.checkout.checkoutAlert("api_fail","Something went wrong. Please retry")}).always(function(){fn.msite.hideloader()})})["catch"](function(){fn.msite.hideloader(),li_fn.checkout.checkoutAlert("api_fail","Something went wrong. Please retry")})):(localStorage.setItem("loyalty_sub_plan",this.getCheckedPlan()),localStorage.setItem("loyalty_direct_pay",!0),$(".login-container").addClass("show"),fn.noScroll())}},{key:"getCheckedPlan",value:function(){for(var a="",b=document.querySelectorAll(".loyalty_plan"),c=0;c<b.length;c++)!0===b[c].checked&&(a=parseInt(b[c].value));return a}},{key:"handlePlanSelectPayPage",value:function(a){var b=null!==a&&void 0!==a?a:this.getCheckedPlan();this.auto_renew_status!==fn.getAutoRenewalFlag()&&(window.location.href="/customer/payments?planId=".concat(b)),this.handlePayPageLoyalty(b)}},{key:"handlePayPageLoyalty",value:function(a){var b=this;fn.ajaxForm({},"GET","/loyalty/single-plan/".concat(a)).done(function(c){var d=JSON.parse(c),e=0>=d.data.strikePrice-d.data.price?"":"\u20B9 "+d.data.strikePrice;$(".order").attr("payFor","loyalty"),$(".order").attr("plan_name",d.data.planName),$(".payment-cart-loyalty-container").show(),$(".pay-amount").html(d.data.price),$(".plan_name").html(d.data.planName),$(".cost_final").html("\u20B9 "+d.data.price),$(".cost_discount").html(e),$(".order").attr("data-payable_amount",d.data.price),$(".order").attr("data_plan_id",1),void 0!==$(".order").attr("data_subPlan_id")&&(b.old_plan=$(".order").attr("data_subPlan_id"));var f=document.querySelectorAll(".loyalty_plan");if(null!==a&&""!==a&&void 0!==a)for(var g=0;g<f.length;g++)f[g].value.toString()===a.toString()?(f[g].checked=!0,f[g].parentNode.parentNode.parentNode.style.border="solid 1px #e41d36"):(f[g].checked=!1,f[g].parentNode.parentNode.parentNode.style.border="none");$(".order").attr("data_subPlan_id",a),li_fn.checkout.applyCoupon({type:"loyalty",sub_program_id:a,amount:d.data.price}),li_fn.payment.liciousWallet({type:"loyalty",sub_program_id:a}).then(function(a){"success"!=a||fn.getAutoRenewalFlag()||li_fn.payment.selectLiciousWalletOnLoad(d.data.price)})["catch"](function(){fn.msite.hideloader()}),void 0!==b.old_plan&&fn.msite.sendAnalyticsData("modifyplan_loyalty",{source:"loyalty",old_plan:b.getPlanDetailText(b.old_plan),new_plan:"".concat(b.getPlanDetailText(b.getCheckedPlan())),auto_renewal:fn.getAutoRenewalType(),click_source:meatopia_data.getDataByKeyName("click_source"),enrolment_type:meatopia_data.getDataByKeyName("enrolment_type")})})}},{key:"getPlanDetailText",value:function(a){var b="",c="";if(this.APIData&&Object.keys(this.APIData).length&&Array.isArray(this.APIData.sub_programs)&&0<this.APIData.sub_programs.length){var d=this.APIData.sub_programs[0];b="".concat(d.name,", ").concat(0>=d.price-d.discounted_price?"0":" ".concat(d.price),",  ").concat(d.discounted_price),c=this.APIData.sub_programs.filter(function(b){return b.id.toString()===a.toString()})}if(c.length){b=c[0].id.toString();var e=c[0];b="".concat(e.name,", ").concat(0>=e.price-e.discounted_price?"0":" ".concat(e.price),",  ").concat(e.discounted_price)}return b.toString()}},{key:"populateSubCancelPopUp",value:function(a){if($(".order_cancel_header").html("Meatopia cancellation*"),$(".cancel_pop_up_order .reason_title").html("Please select your reason for cancellation"),a.hasOwnProperty("cancel_reasons")&&Array.isArray(a.cancel_reasons)&&a.cancel_reasons.length){var b=$(".cancel_pop_up_order .reasons"),c="";a.cancel_reasons.forEach(function(a,b){c+="                            \n              <div class=\"reason\">\n                <div>\n                    <input class=\"radio-custom\" name=\"radio-group\" type=\"radio\" id=\"radio_".concat(b,"\" value=\"").concat(a,"\">\n                    <label for=\"radio_").concat(b,"\" class=\"radio-custom-label\">").concat(a,"</label>\n                </div>\n              </div>")}),b.html(c)}}}]),a}();